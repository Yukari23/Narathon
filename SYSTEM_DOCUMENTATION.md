# ระบบแนะนำสูตรอาหารอัตโนมัติ

## ภาพรวม
ระบบแนะนำสูตรอาหารอัตโนมัติเป็นฟีเจอร์ใหม่ที่แนะนำเมนูที่เหมาะสมกับผู้ป่วยแต่ละกลุ่มโรค โดยอิงจากโรคที่ผู้ใช้เลือกสนใจในโปรไฟล์

## ฟีเจอร์หลัก

### 1. การแนะนำแบบส่วนตัว (Personalized Recommendations)
- ระบบจะอ่านข้อมูลโรคที่ผู้ใช้สนใจจากโปรไฟล์
- แนะนำสูตรอาหารที่เหมาะกับโรคเหล่านั้น
- อัปเดตอัตโนมัติทุก 2 นาที

### 2. การแนะนำแบบสุ่ม (Random Recommendations)
- สำหรับผู้ใช้ที่ยังไม่ได้เลือกโรคที่สนใจ
- แนะนำสูตรอาหารแบบสุ่มจากทั้งหมด

### 3. การอัปเดตแบบเรียลไทม์
- ปุ่มอัปเดตการแนะนำด้วยตนเอง
- นับถอยหลังการอัปเดตอัตโนมัติ
- อัปเดตทันทีเมื่อผู้ใช้เปลี่ยนโรคที่สนใจ

## ไฟล์ที่เกี่ยวข้อง

### API Endpoints
- `/api/recommendations` - API สำหรับแนะนำสูตรอาหารตามโรค

### Components
- `pages/index.js` - หน้าหลักที่แสดงระบบแนะนำ
- `pages/Profile/UserProfile.js` - หน้าจัดการโรคที่สนใจ

### Styles
- `styles/Home.module.css` - สไตล์สำหรับระบบแนะนำ

## วิธีการทำงาน

### 1. การดึงข้อมูลโรคที่สนใจ
```javascript
// ดึงจาก localStorage หรือ API
const userEmail = localStorage.getItem('memberEmail');
const response = await fetch(`/api/recommendations?email=${userEmail}&limit=5`);
```

### 2. ระบบการแนะนำแบบหลายชั้น
1. **ชั้นที่ 1**: หาจาก `Disease_tags` ที่ตรงกับโรคที่ผู้ใช้สนใจ
2. **ชั้นที่ 2**: หาจาก `Disease_code` ที่ตรงกับโรค
3. **ชั้นที่ 3**: เพิ่มสูตรสุ่มถ้ายังไม่ครบตาม limit

### 3. การแสดงผล
- แสดงข้อความแนะนำที่แตกต่างกันตามสถานะผู้ใช้
- แสดงข้อมูลโรคที่ใช้ในการแนะนำ
- ปุ่มอัปเดตการแนะนำด้วยตนเอง

## การใช้งาน

### สำหรับผู้ใช้ทั่วไป
1. เข้าสู่ระบบ
2. ไปที่โปรไฟล์
3. เลือกโรคที่สนใจ
4. กลับมาหน้าหลักเพื่อดูการแนะนำ

### สำหรับผู้ใช้ที่ยังไม่ได้เลือกโรค
- ระบบจะแสดงการแนะนำแบบสุ่ม
- แสดงข้อความแนะนำให้ไปเลือกโรคที่สนใจในโปรไฟล์

## การปรับแต่ง

### เปลี่ยนระยะเวลาอัปเดต
```javascript
// ใน pages/index.js
const interval = setInterval(fetchRecommendedRecipes, 120000); // 2 นาที
```

### เปลี่ยนจำนวนสูตรที่แนะนำ
```javascript
// ในการเรียก API
const response = await fetch(`/api/recommendations?email=${userEmail}&limit=5`);
```

## การพัฒนาต่อ

### ฟีเจอร์ที่สามารถเพิ่มได้
1. **การแนะนำตามประวัติการดู**: บันทึกสูตรที่ผู้ใช้เคยดู
2. **การให้คะแนนสูตร**: ให้ผู้ใช้ให้คะแนนสูตรที่แนะนำ
3. **การแนะนำตามฤดูกาล**: แนะนำสูตรตามช่วงเวลา
4. **การแนะนำตามวัตถุดิบ**: แนะนำตามวัตถุดิบที่มี

### การปรับปรุงประสิทธิภาพ
1. **Cache การแนะนำ**: เก็บผลการแนะนำใน cache
2. **Lazy Loading**: โหลดสูตรเมื่อต้องการ
3. **Infinite Scroll**: แสดงสูตรเพิ่มเติมเมื่อเลื่อนลง

## การแก้ไขปัญหา

### ปัญหาที่พบบ่อย
1. **ไม่แสดงการแนะนำ**: ตรวจสอบ API endpoint และการเชื่อมต่อฐานข้อมูล
2. **การแนะนำไม่ตรงกับโรค**: ตรวจสอบข้อมูลใน `Disease_tags` และ `Disease_code`
3. **อัปเดตไม่ทำงาน**: ตรวจสอบ localStorage และการเชื่อมต่อ API

### การ Debug
```javascript
// เปิด Developer Tools และดู Console
console.log('User diseases:', userDiseases);
console.log('Recommendations:', data.recommendations);
```
